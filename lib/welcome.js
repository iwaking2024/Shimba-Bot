import{DOMImplementation,XMLSerializer}from'xmldom';import _0x392e2f from'jsbarcode';import{JSDOM}from'jsdom';import{readFileSync}from'fs';import{join}from'path';import{spawn}from'child_process';const src=join(__dirname,'..','src'),_svg=readFileSync(join(src,'welcome.svg'),'utf-8'),barcode=_0x16e6b6=>{const _0x9a08ba=new XMLSerializer(),_0x16432c=new DOMImplementation()['createDocument']('http://www.w3.org/1999/xhtml','html',null),_0x4e0d1e=_0x16432c['createElementNS']('http://www.w3.org/2000/svg','svg');return _0x392e2f(_0x4e0d1e,_0x16e6b6,{'xmlDocument':_0x16432c}),_0x9a08ba['serializeToString'](_0x4e0d1e);},imageSetter=(_0x5d3043,_0x3e60dc)=>_0x5d3043['setAttributeNS']('http://www.w3.org/1999/xlink','xlink:href',_0x3e60dc),textSetter=(_0x4b71a9,_0x2b1f47)=>_0x4b71a9['textContent']=_0x2b1f47,{document:svg}=new JSDOM(_svg)['window'],genSVG=async({wid:wid='',pp:pp=join(src,'avatar_contact.png'),title:title='',name:name='',text:text='',background:background=''}={})=>{const _0x2475f1={'code':['#_1661899539392\x20>\x20g:nth-child(6)\x20>\x20image',imageSetter,toBase64(await toImg(barcode(wid['replace'](/[^0-9]/g,'')),'png'),'image/png')],'pp':['#_1661899539392\x20>\x20g:nth-child(3)\x20>\x20image',imageSetter,pp],'text':['#_1661899539392\x20>\x20text.fil1.fnt0',textSetter,text],'title':['#_1661899539392\x20>\x20text.fil2.fnt1',textSetter,title],'name':['#_1661899539392\x20>\x20text.fil2.fnt2',textSetter,name],'bg':['#_1661899539392\x20>\x20g:nth-child(2)\x20>\x20image',imageSetter,background]};for(const [_0x3fb5cb,_0x57b239,_0x3556ee]of Object['values'](_0x2475f1)){_0x57b239(svg['querySelector'](_0x3fb5cb),_0x3556ee);}return svg['body']['innerHTML'];},toImg=(_0x41b0c4,_0x3c6d20='png')=>new Promise((_0x21dcf8,_0x44ae46)=>{if(!_0x41b0c4)return _0x21dcf8(Buffer['alloc'](0x0));const _0x2288e3=[],_0x4fe978=spawn('magick',['convert','svg:-',_0x3c6d20+':-']);_0x4fe978['on']('error',_0x549b22=>_0x44ae46(_0x549b22)),_0x4fe978['stdout']['on']('data',_0x5bdd93=>_0x2288e3['push'](_0x5bdd93)),_0x4fe978['stdin']['write'](Buffer['from'](_0x41b0c4)),_0x4fe978['stdin']['end'](),_0x4fe978['on']('close',_0x55c4ad=>{if(_0x55c4ad!==0x0)_0x44ae46(_0x55c4ad);_0x21dcf8(Buffer['concat'](_0x2288e3));});}),toBase64=(_0x3dbe65,_0x48784a)=>'data:'+_0x48784a+';base64,'+_0x3dbe65['toString']('base64'),render=async({wid:wid='',pp:pp=toBase64(readFileSync(join(src,'avatar_contact.png')),'image/png'),name:name='',title:title='',text:text='',background:background=toBase64(readFileSync(join(src,'Aesthetic','Aesthetic_000.jpeg')),'image/jpeg')}={},_0x197a96='png')=>{const _0x237f04=await genSVG({'wid':wid,'pp':pp,'name':name,'text':text,'background':background,'title':title});return await toImg(_0x237f04,_0x197a96);};if(require['main']===module)render({'wid':'1234567890','name':'John\x20Doe','text':'Lorem\x20ipsum\x0adot\x20sit\x20color','title':'grup\x20testing'},'jpg')['then'](_0x2ec4c6=>{process['stdout']['write'](_0x2ec4c6);});else module['exports']=render;