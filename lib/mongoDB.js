import _0x180503 from'mongoose';const {Schema,connect,model:_model}=_0x180503,defaultOptions={'useNewUrlParser':!![],'useUnifiedTopology':!![]};export class mongoDB{constructor(_0x42d57c,_0x1bdc14=defaultOptions){this['url']=_0x42d57c,this['options']=_0x1bdc14,this['data']=this['_data']={},this['_schema']={},this['_model']={},this['db']=connect(this['url'],{...this['options']})['catch'](console['error']);}async['read'](){this['conn']=await this['db'];const _0x29e006=this['_schema']=new Schema({'data':{'type':Object,'required':!![],'default':{}}});try{this['_model']=_model('data',_0x29e006);}catch{this['_model']=_model('data');}this['_data']=await this['_model']['findOne']({});if(!this['_data']){this['data']={};const [_0xfe0a5e,_0xaab0cd]=await Promise['all']([this['write'](this['data']),this['_model']['findOne']({})]);this['_data']=_0xaab0cd;}else this['data']=this['_data']['data'];return this['data'];}['write'](_0x3b42b9){return new Promise(async(_0x3c2f7f,_0x560556)=>{if(!_0x3b42b9)return _0x560556(_0x3b42b9);if(!this['_data'])return _0x3c2f7f(new this['_model']({'data':_0x3b42b9})['save']());this['_model']['findById'](this['_data']['_id'],(_0xb9965e,_0x1ae7ae)=>{if(_0xb9965e)return _0x560556(_0xb9965e);if(!_0x1ae7ae['data'])_0x1ae7ae['data']={};return _0x1ae7ae['data']=_0x3b42b9,this['data']={},_0x1ae7ae['save'](_0x3c2f7f);});});}}export const mongoDBV2=class MongoDBV2{constructor(_0x59dd97,_0x291e67=defaultOptions){this['url']=_0x59dd97,this['options']=_0x291e67,this['models']=[],this['data']={},this['lists'],this['list'],this['db']=connect(this['url'],{...this['options']})['catch'](console['error']);}async['read'](){this['conn']=await this['db'];const _0xe33a0d=new Schema({'data':[{'name':String}]});try{this['list']=_model('lists',_0xe33a0d);}catch(_0x4ec85c){this['list']=_model('lists');}this['lists']=await this['list']['findOne']({});!lists?.['data']&&(await this['list']['create']({'data':[]}),this['lists']=await this['list']['findOne']({}));const _0x341d35=[];for(const {name:_0x50bfa7}of this['lists']['data']){let _0x2dc452;try{_0x2dc452=_model(_0x50bfa7,new Schema({'data':Array}));}catch(_0x16fa40){console['error'](_0x16fa40);try{_0x2dc452=_model(_0x50bfa7);}catch(_0x16cb9d){_0x341d35['push'](_0x50bfa7),console['error'](_0x16cb9d);}}if(_0x2dc452){this['models']['push']({'name':_0x50bfa7,'model':_0x2dc452});const _0x440d51=await _0x2dc452['find']({});this['data'][_0x50bfa7]=Object['fromEntries'](_0x440d51['map'](_0x2bdb81=>_0x2bdb81['data']));}}try{const _0x4a9d48=await this['list']['findById'](this['lists']['_id']);_0x4a9d48['data']=_0x4a9d48['data']['filter'](_0x256f62=>!_0x341d35['includes'](_0x256f62['name'])),await _0x4a9d48['save']();}catch(_0x46fcf8){console['error'](_0x46fcf8);}return this['data'];}['write'](_0x143e5a){return new Promise(async(_0x526de3,_0x3a310a)=>{if(!this['lists']||!_0x143e5a)return _0x3a310a(_0x143e5a||this['lists']);const _0x2cbd7c=Object['keys'](_0x143e5a),_0x19746d=[];let _0xc6e524=0x0;for(const _0x208857 of _0x2cbd7c){if((_0xc6e524=this['models']['findIndex'](_0x4c6fba=>_0x4c6fba['name']===_0x208857))!==-0x1){const _0x467f25=this['models'][_0xc6e524]['model'];await _0x467f25['deleteMany']()['catch'](console['error']),await _0x467f25['insertMany'](Object['entries'](_0x143e5a[_0x208857])['map'](_0x163eb7=>({'data':_0x163eb7})));if(_0x467f25&&_0x208857)_0x19746d['push']({'name':_0x208857});}else{const _0x225c0c=new Schema({'data':Array});let _0x53b1eb;try{_0x53b1eb=_model(_0x208857,_0x225c0c);}catch(_0x5cf57c){console['error'](_0x5cf57c),_0x53b1eb=_model(_0x208857);}_0xc6e524=this['models']['findIndex'](_0x793869=>_0x793869['name']===_0x208857),this['models'][_0xc6e524===-0x1?this['models']['length']:_0xc6e524]={'name':_0x208857,'model':_0x53b1eb},await _0x53b1eb['insertMany'](Object['entries'](_0x143e5a[_0x208857])['map'](_0x5ccf09=>({'data':_0x5ccf09})));if(_0x53b1eb&&_0x208857)_0x19746d['push']({'name':_0x208857});}}return this['list']['findById'](this['lists']['_id'],function(_0x153714,_0x25eef1){if(_0x153714)return _0x3a310a(_0x153714);return _0x25eef1['data']=_0x19746d,this['data']={},_0x25eef1['save'](_0x526de3);}),_0x526de3(!![]);});}};